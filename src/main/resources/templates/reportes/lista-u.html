<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <div th:replace="recursos/meta.html"></div>
    <title>Reporte de Control de Agua</title>
</head>
<body class="bg-gray-50">
<div th:replace="recursos/aside.html"></div>
<main class="w-full md:w-[calc(100%-256px)] md:ml-64 bg-gray-200 min-h-screen transition-all main">
    <div th:replace="recursos/navbar.html"></div>
    <div class="p-4 md:p-6 lg:p-8">
        <div class="bg-white rounded-2xl shadow-xl p-6 space-y-6">
            <div class="text-center">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Reporte de Control de Agua</h1>
            </div>

            <form th:action="@{/reporte/fecha}" method="post" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Año -->
                <div>
                    <label for="year" class="block text-sm font-medium text-gray-700">Año</label>
                    <select name="year" id="year" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Selecciona un año</option>
                        <option th:each="year : ${availableYears}"
                                th:value="${year}"
                                th:text="${year}"
                                th:selected="${selectedYear == year}"></option>
                    </select>
                </div>

                <!-- Mes -->
                <div>
                    <label for="month" class="block text-sm font-medium text-gray-700">Mes</label>
                    <select name="month" id="month" th:disabled="${selectedYear == null}"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Todos los meses</option>
                        <option th:each="month : ${availableMonths}"
                                th:value="${month}"
                                th:text="${T(java.time.Month).of(month)}"
                                th:selected="${selectedMonth == month}"></option>
                    </select>
                </div>

                <!-- Día -->
                <div>
                    <label for="day" class="block text-sm font-medium text-gray-700">Día</label>
                    <select name="day" id="day" th:disabled="${selectedMonth == null}"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Todos los días</option>
                        <option th:each="day : ${availableDays}"
                                th:value="${day}"
                                th:text="${day}"
                                th:selected="${selectedDay == day}"></option>
                    </select>
                </div>

                <!-- Botón -->
                <div class="md:col-span-3 flex justify-end">
                    <button type="submit"
                            class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Filtrar
                    </button>
                </div>
            </form>

            <!-- Tabla -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 text-sm text-gray-700">
                    <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-2 text-left font-semibold">Usuario</th>
                        <th class="px-4 py-2 text-left font-semibold">Fecha</th>
                        <th class="px-4 py-2 text-left font-semibold">Hora Inicio</th>
                        <th class="px-4 py-2 text-left font-semibold">Hora Fin</th>
                        <th class="px-4 py-2 text-left font-semibold">Minutos</th>
                    </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                    <tr th:each="control : ${controles.content}">
                        <td class="px-4 py-2" th:text="${control.usuario.nombre}"></td>
                        <td class="px-4 py-2" th:text="${#temporals.format(control.fechaRegistro, 'dd-MM-yyyy')}"></td>
                        <td class="px-4 py-2" th:text="${#temporals.format(control.horaInicio, 'HH:mm')}"></td>
                        <td class="px-4 py-2" th:text="${#temporals.format(control.horaFin, 'HH:mm')}"></td>
                        <td class="px-4 py-2" th:text="${control.minutosUtilizados}"></td>
                    </tr>
                    <tr th:if="${controles.totalElements == 0 && selectedYear != null && selectedMonth != null && selectedDay != null}">
                        <td colspan="5" class="px-4 py-3 text-center text-red-600">No se encontraron registros con los filtros seleccionados</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginación -->
            <div class="flex justify-center mt-4">
                <ul class="inline-flex items-center space-x-2">
                    <!-- Anterior -->
                    <li th:if="${paginaActual > 0}">
                        <a th:href="@{/reporte/fecha(page=${paginaActual - 1}, year=${selectedYear}, month=${selectedMonth}, day=${selectedDay})}"
                           class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm">Anterior</a>
                    </li>

                    <!-- Páginas -->
                    <li th:each="i : ${#numbers.sequence(0, controles.totalPages - 1)}">
                        <a th:href="@{/reporte/fecha(page=${i}, year=${selectedYear}, month=${selectedMonth}, day=${selectedDay})}"
                           th:text="${i + 1}"
                           th:classappend="${i == paginaActual} ? 'bg-blue-600 text-white' : 'bg-gray-100 hover:bg-gray-200'"
                           class="px-3 py-1 rounded text-sm transition"></a>
                    </li>

                    <!-- Siguiente -->
                    <li th:if="${paginaActual + 1 < controles.totalPages}">
                        <a th:href="@{/reporte/fecha(page=${paginaActual + 1}, year=${selectedYear}, month=${selectedMonth}, day=${selectedDay})}"
                           class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm">Siguiente</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</main>

<script>
    // JavaScript para actualizar dinámicamente los selects
    document.getElementById('year').addEventListener('change', function() {
        if (this.value) {
            // Enviar el formulario cuando cambia el año
            this.form.submit();
        }
    });

    document.getElementById('month').addEventListener('change', function() {
        if (this.value) {
            // Enviar el formulario cuando cambia el mes
            this.form.submit();
        }
    });
</script>
<script th:src="@{/js/main.js}"></script>

</body>
</html>